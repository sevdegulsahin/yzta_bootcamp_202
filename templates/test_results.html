{% extends "base.html" %}

{% block title %}Test Sonuçları - Interviewly{% endblock %}

{% block content %}

<body data-page-id="test-results">
    <div class="test-results-page">
        <div class="container">
            <!-- Page Data for JS -->
            <div id="page-data"
                data-chart-data="{{ {'labels': ['Doğru', 'Yanlış'], 'data': [correct_answers_count, total_questions_asked - correct_answers_count]}|tojson|safe if is_open_ended_test else '{}'|tojson|safe }}"
                style="display: none;">
            </div>

            <!-- Header Section -->
            <div class="results-header" data-aos="fade-down">
                <div class="header-content">
                    <div class="header-info">
                        <h1 class="page-title"><i class="fas fa-chart-bar"></i>Test Sonuçlarınız</h1>
                        {% if username %}<p class="welcome-text">Merhaba, <strong>{{ username }}</strong>!</p>{% endif
                        %}
                        {% if category %}<p class="test-category">Test Alanı: <strong>{{ category | capitalize
                                }}</strong></p>{% endif %}
                    </div>
                    <div class="completion-badge"><i class="fas fa-trophy"></i><span>Test Tamamlandı!</span></div>
                </div>
            </div>

            <!-- Results Summary -->
            <div class="results-summary" data-aos="fade-up">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="card-icon"><i class="fas fa-question-circle"></i></div>
                        <div class="card-content">
                            <span class="card-value">{{ total_questions_asked }}</span>
                            <span class="card-label">Toplam Soru</span>
                        </div>
                    </div>
                    {% if is_open_ended_test %}
                    <div class="summary-card">
                        <div class="card-icon correct"><i class="fas fa-check-circle"></i></div>
                        <div class="card-content">
                            <span class="card-value">{{ correct_answers_count }}</span>
                            <span class="card-label">Doğru Cevap</span>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="card-icon score"><i class="fas fa-star"></i></div>
                        <div class="card-content">
                            <span class="card-value">{{ score }}</span>
                            <span class="card-label">Puan</span>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="card-icon percentage"><i class="fas fa-percentage"></i></div>
                        <div class="card-content">
                            <span class="card-value">{{ ((correct_answers_count / total_questions_asked) * 100) |
                                round(1) }}%</span>
                            <span class="card-label">Başarı Oranı</span>
                        </div>
                    </div>
                    {% else %}
                    <div class="summary-card">
                        <div class="card-icon pending"><i class="fas fa-clock"></i></div>
                        <div class="card-content">
                            <span class="card-value">Değerlendiriliyor</span>
                            <span class="card-label">AI Analizi</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Performance Chart -->
            {% if is_open_ended_test %}
            <div class="performance-section" data-aos="fade-up" data-aos-delay="100">
                <div class="section-header">
                    <h3 class="section-title"><i class="fas fa-chart-line"></i>Performans Analizi</h3>
                </div>
                <div class="performance-chart"><canvas id="performanceChart"></canvas></div>
            </div>
            {% endif %}

            <!-- Detailed Answers -->
            {% if detailed_answers %}
            <div class="detailed-answers" data-aos="fade-up" data-aos-delay="200">
                <div class="section-header">
                    <h3 class="section-title"><i class="fas fa-list-ul"></i>Detaylı Cevaplarınız</h3>
                    <div class="section-actions">
                        <button class="action-btn" data-action="export"><i class="fas fa-download"></i>Sonuçları
                            İndir</button>
                        <button class="action-btn" data-action="share"><i class="fas fa-share"></i>Paylaş</button>
                    </div>
                </div>
                <div class="answers-list">
                    {% for answer in detailed_answers %}
                    <div class="answer-card" data-aos="fade-up">
                        <div class="answer-header">
                            <div class="answer-number">Soru #{{ loop.index }}</div>
                            {% if answer.is_correct is not none %}
                            <span class="status-badge {{ 'correct' if answer.is_correct else 'incorrect' }}">
                                <i class="fas {{ 'fa-check' if answer.is_correct else 'fa-times' }}"></i>
                                {{ 'Doğru' if answer.is_correct else 'Yanlış' }}
                            </span>
                            {% else %}
                            <span class="status-badge pending"><i class="fas fa-clock"></i>Değerlendiriliyor</span>
                            {% endif %}
                        </div>
                        <div class="answer-content">
                            <h4 class="question-title">Soru</h4>
                            <p class="question-text">{{ answer.question_text }}</p>
                            <h4 class="response-title">Cevabınız</h4>
                            <p class="response-text">{{ answer.user_response }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="action-buttons" data-aos="fade-up" data-aos-delay="400">
                <a href="{{ url_for('interview.create_interview') }}" class="btn btn-primary"><i
                        class="fas fa-plus"></i>Yeni Test Oluştur</a>
                <a href="{{ url_for('interview.my_interviews') }}" class="btn btn-secondary"><i
                        class="fas fa-history"></i>Geçmiş Mülakatlar</a>
                <a href="{{ url_for('main.index') }}" class="btn btn-outline"><i class="fas fa-home"></i>Ana Sayfa</a>
            </div>
        </div>
    </div>
</body>
{% endblock %}