{% extends "base.html" %}

{% block title %}Mülakat Simülasyonu - Interviewly{% endblock %}

{% block content %}

<body data-page-id="interview">
    <div class="interview-page">
        <div class="interview-container">

            <!-- Page Data for JS -->
            <div id="page-data" data-chat-history-length="{{ chat_history|length }}"
                data-reset-url="{{ url_for('interview.reset_interview') }}" style="display: none;">
            </div>

            <!-- Interview Header -->
            <div class="interview-header" data-aos="fade-down">
                <div class="header-content">
                    <div class="interview-info">
                        <h1 class="interview-title">
                            <i class="fas fa-comments"></i>
                            Mülakat Simülasyonu
                        </h1>
                        <p class="interview-subtitle">AI Asistan ile gerçek zamanlı mülakat deneyimi</p>
                    </div>
                    <div class="interview-controls">
                        <div class="timer" id="timer">
                            <i class="fas fa-clock"></i>
                            <span id="timer-display">00:00</span>
                        </div>
                        <button class="btn btn-secondary" onclick="event.preventDefault();">
                            <i class="fas fa-redo"></i>
                            Yeniden Başlat
                        </button>
                        <button class="btn btn-danger">
                            <i class="fas fa-stop"></i>
                            Bitir
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="chat-interface" data-aos="fade-up">
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        {% for message in chat_history %}
                        {% if message.role != 'system' %}
                        <div class="message-wrapper {{ message.role }}">
                            <div class="message {{ message.role }}">
                                <div class="message-avatar">
                                    {% if message.role == 'assistant' %}
                                    <i class="fas fa-robot"></i>
                                    {% else %}
                                    <i class="fas fa-user"></i>
                                    {% endif %}
                                </div>
                                <div class="message-content">
                                    <div class="message-header">
                                        <span class="message-sender">
                                            {% if message.role == 'assistant' %}
                                            AI Mülakatçı
                                            {% else %}
                                            Siz
                                            {% endif %}
                                        </span>
                                        <span class="message-time">{{ loop.index }}</span>
                                    </div>
                                    <div class="message-text">
                                        {{ message.content }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typing-indicator" style="display: none;">
                        <div class="message assistant">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">AI Mülakatçı</span>
                                </div>
                                <div class="typing-dots">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="chat-input-container">
                    <form method="POST" class="chat-form" id="chat-form">
                        <div class="input-wrapper">
                            <textarea name="user_input" id="user-input" class="chat-input"
                                placeholder="Cevabınızı yazın..." rows="1" required maxlength="1000"></textarea>
                            <div class="input-actions">
                                <div class="char-counter" id="char-counter">0/1000</div>
                                <button type="submit" class="send-btn" id="send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Interview Stats -->
            <div class="interview-stats" data-aos="fade-up" data-aos-delay="200">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-comment"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="message-count">0</span>
                            <span class="stat-label">Mesaj</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="elapsed-time">00:00</span>
                            <span class="stat-label">Geçen Süre</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="response-time">-</span>
                            <span class="stat-label">Ort. Yanıt</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- End Interview Modal -->
    <div class="modal" id="endModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Mülakatı Bitir</h3>
            </div>
            <div class="modal-body">
                <p>Mülakatı bitirmek istediğinizden emin misiniz? Bu işlem geri alınamaz.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary">İptal</button>
                <button class="btn btn-danger">Evet, Bitir</button>
            </div>
        </div>
    </div>
</body>
{% endblock %}